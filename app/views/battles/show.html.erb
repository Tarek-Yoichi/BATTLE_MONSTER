<div class="battle"
  data-controller="battle-subscription"
  data-battle-subscription-deck-id-value="<%= @my_deck.id %>"
>
  <h1>Combat #<%= @battle.id %></h1>

  <div class="arena">
    <div class="arena-info">
      <div class="arena-deck-1">
        <div class="deck-label"><p><%= @deck1.monster.name %></p><p><%= @deck1.monster.xp %> xp</p></div>
        <div class="progress-bar blue stripes"><span class="prog-1" style="width:<%= @deck1.hp %>%"></span></div>
      </div>

      <div class="arena-limit">
        <p>VS</p>
      </div>

      <div class="arena-deck-2">
        <div class="deck-label"><p><%= @deck2.monster.xp %> xp</p><p><%= @deck2.monster.name %></p></div>
        <div class="progress-bar blue stripes"><span class="prog-2" style="width:<%= @deck2.hp %>%"></span></div>
      </div>
    </div>

    <div class="arena-deck current-deck-<%= @current_deck.user_id %>">
      <div class="arena-deck-1">
        <div id="arena-deck-1-monster" class="<%= @deck1.monster.specie.name %> idle"></div>
      </div>

      <div class="arena-attack">
        <div id="arena-attack-1">
          <p><%= @deck1.attack.name %></p>
        </div>

        <div id="arena-attack-2">
          <p><%= @deck2.attack.name %></p>
        </div>
      </div>

      <div class="arena-deck-2">
        <p id="arena-deck-2-monster" class="<%= @deck2.monster.specie.name %> idle"></p>
      </div>
    </div>
  </div>

  <div class="rounds" data-battle-subscription-target="rounds">
    <div class="round" data-battle-subscription-target="round">

      <div id="round-controls">
      <p>----</p>

        <% if @deck1.hp <= 0 %>

          <div class="go-control">
            <p>Game Over - <%= @deck2.user.name %> wins ! (<%= @deck2.hp %> hp)</p>
            <%= simple_form_for(@battle) do |f| %>
              <%= f.input :winner, :as => :hidden, :input_html => { :value => @deck2.user_id, :class => 'form-control' } %>
              <%= f.submit 'Retour au menu', :class => 'btn btn-primary' %>
            <% end %>
          </div>

        <% elsif @deck2.hp <= 0 %>

          <div class="go-control">
            <p>Game Over - <%= @deck1.user.name %> wins ! (<%= @deck1.hp %> hp)</p>
            <%= simple_form_for(@battle) do |f| %>
              <%= f.input :winner_id, :as => :hidden, :input_html => { :value => @deck1.user_id, :class => 'form-control' } %>
              <%= f.submit 'Retour au menu', :class => 'btn btn-primary' %>
            <% end %>
          </div>

        <% else %>

          <div class="nx-control">
            <% if @current_deck.user == current_user %>
              <p>Round <%= @battle.round %> : <%= @current_deck.user.name %> Ã  toi de jouer > <a data-action="click->battle-subscription#next" href="<%= battle_next_round_path(@battle, @next_deck) %>">Lancer <%= @current_deck.attack.name %> !</a></p>
            <% else %>
              <p>Round <%= @battle.round %> : Votre adversaire est en train de jouer !</p>
            <% end %>
          </div>

        <% end %>

      <p>----</p>
      </div>

    </div>
  </div>

</div>
